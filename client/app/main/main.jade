div(ng-include='"components/navbar/navbar.html"')

.container
	.row
		.col-md-12
			.panel.panel-default
				.panel-heading 
					h4 Entity Graph Search
				.panel-body

					
					.row
						.col-md-6
							.col-md-12
								h4 Search Filters
								.col-md-12.custom-search-input
									input.search-query.form-control(ng-model="filterPhone" type='text', placeholder='Phone Number')
								.col-md-12.custom-search-input
									input.search-query.form-control(ng-model="filterText" type='text', placeholder='Ad Text')
													
							//- .col-md-12
							//- 	button.btn-danger(ng-click="count = count+1" ng-init="count=0")  Search all entites
							.col-md-12
								h4 Controls
								label Blur Images:  
									input(type="checkbox" ng-model="blur")
								br
								br

						.col-md-6(ng-if='searchedEntities.length > 0')
							h4 Aggregates
							// TODO: use accordion to expand or hide these aggregate statistics
							// TODO: ng-repeat rows over an array of aggregate properties.
							table.table.table-hover
								tbody
									tr
										td Entities: 
										td {{aggregates.get('entityIds').length}}
									tr(ng-if="aggregates.get('nAds').length > 0")
										td Total Ads
										td {{aggregates.get('nAds')}}
									tr(ng-if="aggregates.get('nPictures').length > 0")
										td Total Pictures
										td ---
									tr(ng-if="aggregates.get('phones').length > 0")
										td Phone Numbers
										td {{aggregates.get('phones').join(', ') | tel}}
									tr(ng-if="aggregates.get('websites').length > 0")
										td Websites
										td {{aggregates.get('websites').join(', ')}}
									tr(ng-if="aggregates.get('ages').length > 0")
										td Ages
										td {{aggregates.get('ages').join(', ')}}
									tr(ng-if="aggregates.get('socialMediaAccounts').length > 0")
										td Social Media Accounts
										td ---
									tr(ng-if="aggregates.get('prices').length > 0")
										td Price Range
										td ---
									tr(ng-if="aggregates.get('cities').length > 0")
										td Cities
										td {{aggregates.get('cities').join(', ')}}
									tr(ng-if="aggregates.get('ethnicities').length > 0")
										td Ethnicities
										td ----
	.row

		//.col-md-12(ng-repeat="entity in entities | orderBy:'-nSuggested' | filter: { phone : filterPhone, text: filterText, gt : filterMinAge } ")
		//.col-md-12(ng-repeat="entity in searchedEntities | orderBy:'-nSuggested' ")
		.col-md-12(ng-repeat="entity in entities1 | orderBy:'-nSuggested' | filter: { phone : filterPhone} ")
			.panel.panel-default
				.panel-heading 
					h3 Entity Profile Summary: {{entity.phone | tel}}
				.panel-body
					.col-md-4
						p Ads: {{entity.nPosts}}
						p Active since: {{entity.firstPostTime.toDateString()}}
						p(ng-if='entity.name && entity.name.length > 0') Listed names: {{entity.name.join(', ') | capitalize}}
						p(ng-if='entity.age && entity.age.length > 0') Listed ages: {{entity.age.join(', ')}}
						p(ng-if='entity.priceRange && entity.priceRange.length > 0') Listed price range: {{entity.priceRange}} 
						p(ng-if='entity.city && entity.city.length > 0') Cities: {{entity.city.join(', ') | capitalize}}
						p(ng-if='entity.website && entity.website.length > 0') Websites:  {{entity.website.join(', ')}}
						p(ng-if='entity.imageUrls && entity.imageUrls.length > 0') Pictures: {{entity.imageUrls.length}}
						p Pictures with Face: {{entity.nFaces}}
						p Ads related by image: {{entity.nSuggestedByImage}}
						p Ads related by text: {{entity.nSuggestedByText}}
						p Ads related by phone co-occurence: {{entity.nSuggestedByPhone}}
						a.button.btn-primary.btn-lg.pull-left(ui-sref="entitydetail({ id: entity.id })") Inspect
					
					.col-md-8
						.panel.panel-default
							.panel-heading
								.panel-title 
									//- h4 Most Recent Post at {{entity.website[0]}} on {{entity.lastPostTime.toDateString()}}
									
							.panel-body.vertical-layout
								.item 
									//- h4 {{entity.title[0]}}
								.item
									p 
										//- | {{entity.text[0]}}
								.item
									.row
										.col-md-2(ng-repeat='img in entity.imageUrls | limitTo:50')					
											img.responsive(ng-src="{{img}}" 
												style="max-height:50px; margin:0 auto;"
												ng-class="{blurry: blur == true, clear: blur != true}")
																	
	footer.footer
		center Designed and Developed by Qadium 2015. All code is open source.
		center About Help Terms Privacy 
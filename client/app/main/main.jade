div(ng-include='"components/navbar/navbar.html"')
.container
	.row
		.col-md-12
			.panel.panel-default
				.panel-heading
					h3 Elastic Search (Beta)
				.panel-body
					.row
						.col-md-12.form
								form(ng-submit='submitElasticSearch()' ng-click="counter = counter + 1" ng-init="counter=0")
									input.search-query.form-control(type='text',ng-model='elasticSearchText', name='text', placeholder='Search...')
									input.btn.btn-primary#submit(type='submit', value='Submit')
									br
									br
									p You've done {{counter}} Elastic Search searches

	.row
		.col-md-12
			.panel.panel-default
				.panel-heading
					h3 Entity Graph Search
				.panel-body
					.row
						.col-md-3
							.col-md-12.form
								form(ng-submit='submitSearch()')
									input.search-query.form-control(type='text',ng-model='searchText', name='text', placeholder='Search...')
									input.btn.btn-primary#submit(type='submit', value='Submit')
							//- .col-md-12
								//- h4 Search Filters
								//- .col-md-12.custom-search-input
								//- 	input.search-query.form-control(ng-model="filterPhone" type='text', placeholder='Phone Number')
								//- .col-md-12.custom-search-input
								//- 	input.search-query.form-control(ng-model="filterText" type='text', placeholder='Ad Text')
							.col-md-12
								br
								h4 Controls

								label Blur Images: 
									input(type="checkbox", ng-model="blur", ng-init="checked=true")
								label Has Face Picture: 
									input(type="checkbox", ng-model="hasFacePic")
								label Has Similar Ads: 
									input(type="checkbox", ng-model="hasSimilarAds")
								label Has Social Media 
									input(type="checkbox", ng-model="hasSocialMedia")
								br
								br
							
						.col-md-3
							h4 Aggregate Results

							table.table.table-hover
								tbody
									tr
										td Entities
										td {{aggregates.get('entityIds').length}}
									tr
										td Ads
										td {{aggregates.get('nAds')}}
									tr
										td Pictures
										td {{aggregates.get('nPictures')}}
									tr(ng-if="aggregates.get('age_min').length > 0")
										td Age Range
										td {{aggregates.get('age_min')}} to {{aggregates.get('age_max')}}
									tr(ng-if="aggregates.get('rate60').length > 0")
										td Price Range
										td(ng-if="aggregates.get('price_max') != 9999"){{aggregates.get('price_min') | currency:"$"}} to {{aggregates.get('price_max') | currency:"$"}}
						.col-md-6
							accordion(close-others='oneAtATime')
								accordion-group(heading='Search Result Details (Click Me!)', is-disabled='status.isFirstDisabled')
									h4
									table.table.table-hover(ng-if="aggregates.get('entityIds').length > 0")
										tbody
											tr(ng-if="aggregates.get('websites').length > 0")
												td Websites
												td {{aggregates.get('websites').join(', ')}}
											tr(ng-if="aggregates.get('twitters').length > 0")
												td Twitter Accounts
												td {{aggregates.get('twitters').join(', ')}}
											tr(ng-if="aggregates.get('instagrams').length > 0")
												td Instagram Accounts
												td {{aggregates.get('instagrams').join(', ')}}
											tr(ng-if="aggregates.get('cities').length > 0")
												td Cities
												td {{aggregates.get('cities').join(', ') | capitalize}}
											tr(ng-if="aggregates.get('names').length > 0")
												td Names
												td {{aggregates.get('names').join(', ') | capitalize}}
											tr(ng-if="aggregates.get('ethnicities').length > 0")
												td Ethnicities
												td {{aggregates.get('ethnicities').join(', ') | capitalize}}
	.row

		//- .col-md-12(ng-repeat="entity in entities | orderBy:'-nSuggested' | filter: { phone : filterPhone, text: filterText, gt : filterMinAge } ")
		.col-md-12(ng-repeat="entity in entities1 | orderBy:'-nSuggested'  | filter:facesFilter | filter:socialMediaFilter | filter: similarAdsFilter")
			.panel.panel-default
				.panel-heading
					h3 {{entity.nPosts}} Ads from Base Entity {{entity.phone | tel}}
				.panel-body
					.col-md-4
						p Active since: <strong> {{entity.firstPostTime.toDateString()}} </strong>
						p(ng-if='entity.name && entity.name.length > 0') Listed names:  <strong>{{entity.name.join(', ') | capitalize}} </strong>
						p(ng-if='entity.website && entity.website.length > 0') Websites:  <strong> {{entity.website.join(', ')}}</strong>
						p(ng-if='entity.city && entity.city.length > 0') Cities:  <strong>{{entity.city.join(', ') | capitalize}}</strong>
						p(ng-if='entity.age && entity.age.length > 0') Listed ages:  <strong>{{entity.age.join(', ')}}</strong>
						p(ng-if='entity.priceRange && entity.priceRange.length > 0') Listed price range: <strong>{{entity.priceRange}} </strong>
						p(ng-if='entity.imageUrls && entity.imageUrls.length > 0')  Pictures: <strong> {{entity.imageUrls.length}}</strong>
						p Pictures with Face: <strong> {{entity.face.length}} </strong>
						p Ads related by image: <strong> {{entity.nSuggestedByImage}}</strong>
						p Ads related by text:<strong> {{entity.nSuggestedByText}}</strong>
						//- p Ads related by phone co-occurence:  <strong> {{entity.nSuggestedByPhone}}</strong>
						p Social Media Accounts: <strong> {{entity.socialmedia}}</strong>

						a.button.btn-primary.btn-lg.pull-left(ui-sref="entitydetail({ id: entity.id })") Inspect

					.col-md-8
						.panel.panel-default
							.panel-heading
								.panel-title
									h4 Most Recent Post at {{entity.website[0]}} on {{entity.lastPostTime.toDateString()}}

							.panel-body.vertical-layout
								.item
									h4 {{entity.title[0]}}
								.item
									p
										| {{entity.text[0]}}
								.item
									.row
										.col-md-2(ng-repeat='img in entity.imageUrls | limitTo:50')	 
											img.responsive(ng-src="{{img}}"
												style="max-height:50px; margin:0 auto;"
												ng-class="{blurry: blur == true, clear: blur != true}")

	footer.footer
		center Designed and Developed by Qadium 2015. All code is open source.
		center About Help Terms Privacy

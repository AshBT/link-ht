div(ng-include='"components/navbar/navbar.html"')

.container
	.row
		.col-md-12
			.panel.panel-default
				.panel-body
					.col-md-3.form
					.col-md-6.form
						center
							h1 <strong> Link <span style="color:#ff5351;"> HT </span></strong>
							form(ng-submit='submitElasticSearch()' ng-click="counter = counter + 1" ng-init="counter=0")
								input.search-query.form-control(type='text',ng-model='elasticSearchText', name='text', placeholder='Search...')
								input.btn.btn-primary#submit(type='submit', value='Submit')
					.col-md-3.form
				.search-body.panel-body(ng-if="aggregates.get('entityIds').length > 0")
					.row
						.col-md-2
							h3(style='color:blue') Controls
							label(style='color:blue') Blur Images: 
								input(type="checkbox", ng-model="blur", ng-init="checked=true")
							label(style='color:blue') Has Face Picture: 
								input(type="checkbox", ng-model="hasFacePic")
							label(style='color:blue') Has Similar Ads: 
								input(type="checkbox", ng-model="hasSimilarAds")
							label(style='color:blue') Has Social Media 
								input(type="checkbox", ng-model="hasSocialMedia")
						.col-md-10
							h3 Search Results Summary
							h4 <strong> {{aggregates.get('entityIds').length}} groups </strong>  -- <strong> {{aggregates.get('nAds')}} ads </strong> with <strong> {{aggregates.get('nPictures')}} </strong> pictures. 
							h5(ng-if="aggregates.get('age_min').length > 0") Extracted age range: {{aggregates.get('age_min')}} to {{aggregates.get('age_max')}}.
							h5(ng-if="aggregates.get('rate60').length > 0") Extracted price range: {{aggregates.get('price_min') | currency:"$"}} to {{aggregates.get('price_max') | currency:"$"}}. 
						.col-md-2
						.col-md-10
							accordion(close-others='oneAtATime')
								accordion-group(heading='Click here for more summary details', is-disabled='status.isFirstDisabled')
									table.table.table-hover(ng-if="aggregates.get('entityIds').length > 0")
										tbody
											tr(ng-if="aggregates.get('websites').length > 0")
												td Websites hosting ads in search results
												td {{aggregates.get('websites').sort().join(', ')}}
											tr(ng-if="aggregates.get('twitters').length > 0")
												td Twitter Accounts extracted from search results
												td {{aggregates.get('twitters').sort().join(', ')}}
											tr(ng-if="aggregates.get('instagrams').length > 0")
												td Instagram Accounts extracted from search results
												td {{aggregates.get('instagrams').sort().join(', ')}}
											tr(ng-if="aggregates.get('cities').length > 0")
												td Cities extracted from search results
												td {{aggregates.get('cities').sort().join(', ') | capitalize}}
											tr(ng-if="aggregates.get('names').length > 0")
												td Names extracted from search results
												td {{aggregates.get('names').sort().join(', ') | capitalize}}
											tr(ng-if="aggregates.get('ethnicities').length > 0")
												td Ethnicities extracted from search results
												td {{aggregates.get('ethnicities').sort().join(', ') | capitalize}}		
								
	.row
		.col-md-12(ng-if='entities1 && entities1.length == 0')
			accordion(close-others='oneAtATime')
				accordion-group(heading='Example Search Result', is-disabled='status.isFirstDisabled')
					.panel.panel-default
						.panel-heading
							h3 Group Identification Number -- Phone Number(s)  -- (# of Ads)
						.panel-body
							.col-md-4
								h4 Dates Active
								h4 Names Extracted
								h4 E-mails Extracted
								h4 Ages Extracted
								h4 Price Range
								p Websites
								p Cities
								p # of Pictures
								p # of Face Pictures
								p # of Ads with Similar Pictures
								p # of Ads with Similar Text
								//- p Ads related by phone co-occurence:  <strong> {{entity.nSuggestedByPhone}}</strong>
								p # of Social Media Accounts Extracted
							.col-md-8
								.col-md-12
									.panel.panel-default
										.panel-heading
											.panel-title
												h4 Snippets of Ads Containing Search Terms (# of Ads)
										.panel-body.vertical-layout
											p Snippet of ad text with search terms <span style="background-color: #FFFF00">  highlighted </span> 
								.col-md-12
									.panel.panel-default
										.panel-heading
											.panel-title
												h4 Most Recent Ad
										.panel-body.vertical-layout
											.item
												h4 Title of Ad
											.item
												p Text of Ad
												p Images from Ad
		.col-md-12(ng-if='entities1 && entities1.length > 0')
			center
				h2 View Group Summaries in Search Results Below
		.col-md-12(ng-repeat="entity in entities1 | orderBy:'-nSuggested'  | filter:facesFilter | filter:socialMediaFilter | filter: similarAdsFilter")
			.panel.panel-default
				.panel-heading
					h3 Group {{entity.id}} -- <strong> Phone Number(s): <strong> {{entity.phone | tel}} </strong>   -- </strong>  ({{entity.nPosts}} Ads)
				.panel-body
					.col-md-4
						h4 Active between <strong> {{entity.firstPostTime.toDateString()}} </strong> to <strong> {{entity.lastPostTime.toDateString()}} </strong>
						h4(ng-if='entity.name && entity.name.length > 0') Listed names:  <strong>{{entity.name.join(', ') | capitalize}} </strong>
						h4(ng-if='entity.email && entity.email.length > 0') Listed e-mails:  <strong>{{entity.email.join(', ')}}</strong>
						h4(ng-if='entity.age && entity.age.length > 0') Listed ages:  <strong>{{entity.age.join(', ')}}</strong>
						h4(ng-if='entity.priceRange && entity.priceRange.length > 0') Listed price range: <strong>{{entity.priceRange}} </strong>
						p(ng-if='entity.website && entity.website.length > 0') Websites:  <strong> {{entity.website.sort().join(', ')}}</strong>
						p(ng-if='entity.city && entity.city.length > 0') Cities:  <strong>{{entity.city.sort().join(', ') | capitalize}}</strong>
						p(ng-if='entity.imageUrls && entity.imageUrls.length > 0')  Pictures: <strong> {{entity.imageUrls.length}}</strong>
						p(ng-if='entity.face && entity.face.length > 0') Pictures with Face: <strong> {{entity.face.length}} </strong>
						p Ads related by image: <strong> {{entity.nSuggestedByImage}}</strong>
						p Ads related by text:<strong> {{entity.nSuggestedByText}}</strong>
						//- p Ads related by phone co-occurence:  <strong> {{entity.nSuggestedByPhone}}</strong>
						p Social Media Accounts: <strong> {{entity.socialmedia}}</strong>
						a.button.btn-primary.btn-lg.pull-left(ui-sref="entitydetail({ id: entity.id })") Investigate
					.col-md-8
						.col-md-12
							.panel.panel-default
								.panel-heading
									.panel-title
										h4 Ads Containing Search Terms (# of Ads)
								.panel-body.vertical-layout
									p Place holder for <span style="background-color: #FFFF00"> snippet </span> of search result using Angular Filter + regex
						.col-md-12
							.panel.panel-default
								.panel-heading
									.panel-title
										h4 Most Recent Post at {{entity.website[0]}}
								.panel-body.vertical-layout
									.item
										h4 {{entity.title[0]}}
									.item
										p
											| {{entity.text[0]}}
									.item
										.row
											.col-md-2(ng-repeat='img in entity.imageUrls | limitTo:50')	 
												img.responsive(ng-src="{{img}}"
													style="max-height:50px; margin:0 auto;"
													ng-class="{blurry: blur == true, clear: blur != true}")
	footer.footer
		center Designed and Developed by Qadium 2015 for DARPA's Memex program. 
		center Check out the open source code for Link HT on <a href='https://github.com/qadium/link-ht'> Github</a>.
		center <a href='posts'> About </a> | <a href='posts'> Help </a> | <a href='posts'> Terms </a> | <a href='posts'> Privacy </a> | <a href="mailto:memex@qadium.com?Subject=Link%20HT%20Feedback" target="_top">Submit Feedback</a>